<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dead End Traders - Character Sheet</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#000; color:#0ff; }
    #container { width:100%; max-width:1200px; margin:20px auto; }
    .tab-buttons { text-align:center; margin-bottom:20px; }
    .tab-buttons button { background:#0ff; color:#000; border:none; padding:10px 20px; margin:5px; cursor:pointer; }
    .tab-buttons button.active { background:#ff0; }
    .tab-content { display:none; position:relative; }
    .tab-content.active { display:block; }
    img.sheet { width:100%; height:auto; display:block; }
    .overlay { position:absolute; color:#0ff; font-size:16px; }
    input, textarea { background:rgba(0,0,0,0.6); color:#0ff; border:1px solid #0ff; padding:4px; }
    .dot { cursor:pointer; width:20px; height:20px; line-height:20px; text-align:center; font-size:18px; display:inline-block; margin:0 2px; }
    .filled { color:#ff0; }
    .pool-sum { font-weight:bold; margin-left:10px; }
    .bar { width:100%; height:10px; background:#333; border:1px solid #0ff; }
    .bar-fill { height:100%; background:linear-gradient(to right, #0ff, #00f); }
    
    /* Improved avatar upload area */
    #avatar-upload-area {
      position:absolute;
      top:40px;
      left:40px;
      width:280px;
      text-align:center;
      background:rgba(0,0,0,0.6);
      border:2px dashed #0ff;
      border-radius:12px;
      padding:12px;
      box-shadow:0 0 15px rgba(0,255,255,0.4);
    }
    #avatar-preview {
      width:220px;
      height:220px;
      object-fit:cover;
      border:3px solid #0ff;
      border-radius:10px;
      background:#111;
      margin-bottom:10px;
      box-shadow:0 0 12px #0ff;
    }
    #avatar-url-input {
      width:100%;
      margin-bottom:10px;
      text-align:center;
    }
    #upload-avatar-btn {
      background:#0ff;
      color:#000;
      border:none;
      padding:12px 24px;
      font-size:16px;
      font-weight:bold;
      border-radius:8px;
      cursor:pointer;
      margin:5px;
      box-shadow:0 2px 8px rgba(0,255,255,0.5);
    }
    #upload-avatar-btn:hover {
      background:#0cf;
      box-shadow:0 0 15px #0ff;
    }
    
    .skills-column { display:flex; flex-direction:column; }
    .skill-row { margin-bottom:5px; display:flex; align-items:center; }
    .skill-label { width:120px; text-align:right; margin-right:10px; }
    #export-btn { background:#ff0; color:#000; border:none; padding:10px; cursor:pointer; margin-top:10px; }
    
    /* Reset button */
    #reset-btn {
      background:#c00; color:white; border:none; padding:12px 24px;
      font-size:16px; font-weight:bold; border-radius:6px; cursor:pointer;
      margin:20px 10px; box-shadow:0 2px 6px rgba(0,0,0,0.5);
    }
    #reset-btn:hover { background:#f00; }
  </style>
</head>
<body>

<div id="container">
  <div class="tab-buttons">
    <button onclick="openTab('page1')" class="active">Page 1: Attributes</button>
    <button onclick="openTab('page2')">Page 2: Talents & Inventory</button>
    <button onclick="openTab('page3')">Page 3: Augments</button>
    <button onclick="openTab('page4')">Page 4: Biography</button>
    <button onclick="openTab('page5')">Page 5: Extra Bio</button>
  </div>

  <button id="export-btn" onclick="exportData()">Export Data</button>
  <input type="file" id="import-btn" accept=".json" style="display:none;" onchange="importData(event)">
  <button onclick="document.getElementById('import-btn').click()">Import Data</button>

  <button id="reset-btn" onclick="clearAllData()">Reset / Clear All Saved Data</button>

  <div id="page1" class="tab-content active">
    <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/CHARACTER%20SHEET%201.png" alt="Page 1">
    
    <!-- Improved Avatar Upload Section -->
    <div id="avatar-upload-area">
      <div style="margin-bottom:8px; font-weight:bold; font-size:18px;">Character Avatar</div>
      
      <img id="avatar-preview" src="" alt="Avatar Preview">
      
      <input type="text" id="avatar-url-input" data-key="avatar-url" placeholder="Paste image URL here" style="width:100%;margin-bottom:10px;">
      
      <label for="avatar-file-input" id="upload-avatar-btn">
        Upload Avatar
      </label>
      <input type="file" id="avatar-file-input" accept="image/*" onchange="handleAvatarUpload(this)" style="display:none;">
    </div>
    
    <!-- Name -->
    <div class="overlay" style="top:540px; left:50px; width:240px;">
      <input type="text" data-key="name" placeholder="Name" style="width:100%;">
    </div>
    
    <!-- Titles -->
    <div class="overlay" style="top:570px; left:50px; width:240px;">
      <input type="text" data-key="titles" placeholder="Titles" style="width:100%;">
    </div>
    
    <!-- LV -->
    <div class="overlay" style="top:600px; left:50px; width:120px;">
      <input type="number" data-key="lv" placeholder="LV" style="width:100%;">
    </div>
    
    <!-- Health bar -->
    <div class="overlay" style="top:630px; left:50px; width:240px;">
      <div class="bar"><div class="bar-fill" id="health-fill" style="width:50%;"></div></div>
      <input type="range" data-key="health" min="0" max="100" value="50" style="width:100%;" oninput="updateBar(this, 'health-fill')">
    </div>
    
    <!-- EXP -->
    <div class="overlay" style="top:180px; left:50px; width:120px;">
      <input type="number" data-key="exp" placeholder="EXP" style="width:100%;">
    </div>
    
    <!-- FAME -->
    <div class="overlay" style="top:150px; left:50px; width:120px;">
      <input type="number" data-key="fame" placeholder="FAME" style="width:100%;">
    </div>
    
    <!-- Kills -->
    <div class="overlay" style="top:510px; left:50px; width:120px;">
      <input type="number" data-key="kills" placeholder="Kills" style="width:100%;">
    </div>
    
    <!-- FatePoint -->
    <div class="overlay" style="top:480px; left:50px; width:120px;">
      <input type="number" data-key="fatepoint" placeholder="FatePoint" style="width:100%;">
    </div>
    
    <!-- Mental Attributes -->
    <div class="overlay" style="top:150px; left:360px; width:480px;">
      <div class="skill-row">
        <span class="skill-label">Wits</span>
        <span class="dot" data-key="wits1" onclick="toggleDot(this)">○</span><span class="dot" data-key="wits2" onclick="toggleDot(this)">○</span><span class="dot" data-key="wits3" onclick="toggleDot(this)">○</span><span class="dot" data-key="wits4" onclick="toggleDot(this)">○</span><span class="dot" data-key="wits5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="wits-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:30px;">
        <span class="skill-label">Perception</span>
        <span class="dot" data-key="perc1" onclick="toggleDot(this)">○</span><span class="dot" data-key="perc2" onclick="toggleDot(this)">○</span><span class="dot" data-key="perc3" onclick="toggleDot(this)">○</span><span class="dot" data-key="perc4" onclick="toggleDot(this)">○</span><span class="dot" data-key="perc5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="perc-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:30px;">
        <span class="skill-label">Intelligence</span>
        <span class="dot" data-key="int1" onclick="toggleDot(this)">○</span><span class="dot" data-key="int2" onclick="toggleDot(this)">○</span><span class="dot" data-key="int3" onclick="toggleDot(this)">○</span><span class="dot" data-key="int4" onclick="toggleDot(this)">○</span><span class="dot" data-key="int5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="int-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:30px;">
        <span class="skill-label">Charisma</span>
        <span class="dot" data-key="char1" onclick="toggleDot(this)">○</span><span class="dot" data-key="char2" onclick="toggleDot(this)">○</span><span class="dot" data-key="char3" onclick="toggleDot(this)">○</span><span class="dot" data-key="char4" onclick="toggleDot(this)">○</span><span class="dot" data-key="char5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="char-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:30px;">
        <span class="skill-label">Manipulation</span>
        <span class="dot" data-key="manip1" onclick="toggleDot(this)">○</span><span class="dot" data-key="manip2" onclick="toggleDot(this)">○</span><span class="dot" data-key="manip3" onclick="toggleDot(this)">○</span><span class="dot" data-key="manip4" onclick="toggleDot(this)">○</span><span class="dot" data-key="manip5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="manip-sum">0</span>
      </div>
    </div>
    
    <!-- Physical Attributes -->
    <div class="overlay" style="top:450px; left:360px; width:480px;">
      <div class="skill-row">
        <span class="skill-label">Strength</span>
        <span class="dot" data-key="str1" onclick="toggleDot(this)">○</span><span class="dot" data-key="str2" onclick="toggleDot(this)">○</span><span class="dot" data-key="str3" onclick="toggleDot(this)">○</span><span class="dot" data-key="str4" onclick="toggleDot(this)">○</span><span class="dot" data-key="str5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="str-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:30px;">
        <span class="skill-label">Dexterity</span>
        <span class="dot" data-key="dex1" onclick="toggleDot(this)">○</span><span class="dot" data-key="dex2" onclick="toggleDot(this)">○</span><span class="dot" data-key="dex3" onclick="toggleDot(this)">○</span><span class="dot" data-key="dex4" onclick="toggleDot(this)">○</span><span class="dot" data-key="dex5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="dex-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:30px;">
        <span class="skill-label">Stamina</span>
        <span class="dot" data-key="stam1" onclick="toggleDot(this)">○</span><span class="dot" data-key="stam2" onclick="toggleDot(this)">○</span><span class="dot" data-key="stam3" onclick="toggleDot(this)">○</span><span class="dot" data-key="stam4" onclick="toggleDot(this)">○</span><span class="dot" data-key="stam5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="stam-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:30px;">
        <span class="skill-label">Psionics</span>
        <span class="dot" data-key="psio1" onclick="toggleDot(this)">○</span><span class="dot" data-key="psio2" onclick="toggleDot(this)">○</span><span class="dot" data-key="psio3" onclick="toggleDot(this)">○</span><span class="dot" data-key="psio4" onclick="toggleDot(this)">○</span><span class="dot" data-key="psio5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="psio-sum">0</span>
      </div>
    </div>
    
    <!-- Talents and Debuffs -->
    <div class="overlay" style="top:150px; left:840px; width:300px; height:240px;">
      <textarea data-key="talents" placeholder="Talents and Debuffs..." style="width:100%; height:100%;"></textarea>
    </div>
  </div>

  <!-- Page 2, 3, 4, 5 – add your current content here if different -->
  <!-- For now using placeholders – replace with your actual markup -->

  <div id="page2" class="tab-content">
    <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/CHARACTER%20SHEET%20inventory2.png" alt="Page 2">
    <!-- Your talents & inventory overlays here -->
  </div>

  <div id="page3" class="tab-content">
    <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/back%20fill%20CHARACTER%203.png" alt="Page 3">
    <!-- Your augment overlays here -->
  </div>

  <div id="page4" class="tab-content">
    <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/back%20fill%20bio%204.png" alt="Page 4">
    <!-- Your bio overlays here -->
  </div>

  <div id="page5" class="tab-content">
    <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/back%20fill%20bio%204%20-%20Copy.png" alt="Page 5">
    <!-- Your extra bio overlays here -->
  </div>

</div>

<script>
// Player namespacing
let playerKey = localStorage.getItem('playerName') || prompt('Enter your player name:') || 'default';
localStorage.setItem('playerName', playerKey);
function getStorageKey(key) { return `${playerKey}_${key}`; }

// Tab switching
function openTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.tab-buttons button').forEach(el => el.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  event.target.classList.add('active');
}

// Toggle dot
function toggleDot(el) {
  el.textContent = el.textContent === '○' ? '●' : '○';
  el.classList.toggle('filled');
  saveData(el);
  updateSum(el.closest('.skill-row'));
}

// Update sum
function updateSum(section) {
  const sumEl = section.querySelector('.pool-sum');
  if (sumEl) sumEl.textContent = section.querySelectorAll('.filled').length;
}

// Bar update
function updateBar(input, fillId) {
  document.getElementById(fillId).style.width = `${input.value}%`;
  saveData(input);
}

// Avatar handling (file + URL)
function handleAvatarUpload(input) {
  const file = input.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = e => {
      document.getElementById('avatar-preview').src = e.target.result;
      localStorage.setItem(getStorageKey('avatar-data'), e.target.result);
    };
    reader.readAsDataURL(file);
  }
}

// Save/load
function saveData(el) {
  const key = getStorageKey(el.dataset.key);
  if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
    localStorage.setItem(key, el.value);
  } else {
    localStorage.setItem(key, el.textContent);
  }
}

window.addEventListener('load', () => {
  document.querySelectorAll('input[data-key], textarea[data-key]').forEach(el => {
    el.value = localStorage.getItem(getStorageKey(el.dataset.key)) || '';
    if (el.type === 'range') updateBar(el, `${el.dataset.key}-fill`);
    el.addEventListener('input', () => saveData(el));
  });
  document.querySelectorAll('.dot').forEach(el => {
    const saved = localStorage.getItem(getStorageKey(el.dataset.key));
    if (saved) {
      el.textContent = saved;
      if (saved === '●') el.classList.add('filled');
    }
    updateSum(el.closest('.skill-row'));
  });
  // Load avatar
  const avatarUrl = localStorage.getItem(getStorageKey('avatar-url'));
  const avatarData = localStorage.getItem(getStorageKey('avatar-data'));
  document.getElementById('avatar-preview').src = avatarData || avatarUrl || '';
  document.getElementById('avatar-url-input').value = avatarUrl || '';
  document.getElementById('avatar-url-input').addEventListener('input', e => {
    document.getElementById('avatar-preview').src = e.target.value;
    saveData(e.target);
  });
});

// Auto-save
setInterval(() => document.querySelectorAll('input, textarea, .dot').forEach(saveData), 5000);

// Export data
function exportData() {
  const data = {};
  document.querySelectorAll('[data-key]').forEach(el => {
    data[el.dataset.key] = el.value || el.textContent;
  });
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'character-sheet.json';
  a.click();
  URL.revokeObjectURL(url);
}

// Import data
function importData(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = e => {
      const data = JSON.parse(e.target.result);
      Object.keys(data).forEach(key => {
        const el = document.querySelector(`[data-key="${key}"]`);
        if (el) {
          if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
            el.value = data[key];
          } else {
            el.textContent = data[key];
            if (data[key] === '●') el.classList.add('filled');
          }
        }
        if (key === 'avatar-data' || key === 'avatar-url') {
          document.getElementById('avatar-preview').src = data[key];
        }
      });
      document.querySelectorAll('.skill-row').forEach(updateSum);
    };
    reader.readAsText(file);
  }
}

// Clear all data with confirmation
function clearAllData() {
  const confirmed = confirm(
    "Are you sure you want to CLEAR ALL saved data for this character?\n\n" +
    "This will reset:\n" +
    "- All attributes, dots, numbers, text fields\n" +
    "- Talents, inventory, biography, augments\n" +
    "- Avatar image and URL\n" +
    "- Everything saved in your browser for this player name\n\n" +
    "This action CANNOT be undone.\n\n" +
    "Click OK to reset, or Cancel to keep your data."
  );

  if (confirmed) {
    Object.keys(localStorage).forEach(key => {
      if (key.startsWith(playerKey + '_')) {
        localStorage.removeItem(key);
      }
    });
    location.reload();
  }
}
</script>

</body>
</html>
