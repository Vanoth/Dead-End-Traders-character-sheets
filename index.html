<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dead End Traders - Character Sheet</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#000; color:#0ff; }
    #container { width:100%; max-width:1200px; margin:20px auto; }
    .tab-buttons { text-align:center; margin-bottom:20px; }
    .tab-buttons button { background:#0ff; color:#000; border:none; padding:10px 20px; margin:5px; cursor:pointer; }
    .tab-buttons button.active { background:#ff0; }
    .tab-content { display:none; position:relative; }
    .tab-content.active { display:block; }
    img.sheet { width:100%; height:auto; display:block; }
    .overlay { position:absolute; color:#0ff; font-size:16px; }
    input, textarea { background:rgba(0,0,0,0.6); color:#0ff; border:1px solid #0ff; padding:4px; }
    .dot { 
      cursor: pointer; 
      width: 76px; 
      height: 76px; 
      line-height: 76px; 
      text-align: center; 
      font-size: 68px; 
      display: inline-block; 
      margin: 0 12px; 
    }
    .filled { color:#ff0; }
    .pool-sum { font-weight:bold; margin-left:40px; }
    .bar { width:100%; height:28px; background:#333; border:1px solid #0ff; }
    .bar-fill { height:100%; background:linear-gradient(to right, #0ff, #00f); }
    #mana-fill { background: linear-gradient(to right, #a0f, #f0f); }
    #avatar { position:absolute; top:16px; left:23px; width:240px; height:350px; object-fit:cover; border:none; }
    #avatar-input { position:absolute; top:-74px; left:480px; width:240px; }
    .skills-column { display:flex; flex-direction:column; }
    .skill-row { margin-bottom:1px; display:flex; align-items:center; }
    .skill-label { width:120px; text-align:right; margin-right:10px; }
    #export-btn { background:#ff0; color:#000; border:none; padding:10px; cursor:pointer; margin-top:10px; }
    
    /* Reset button styling */
    #reset-btn {
      background:#c00; color:white; border:none; padding:12px 24px;
      font-size:16px; font-weight:bold; border-radius:6px; cursor:pointer;
      margin:20px 10px; box-shadow:0 2px 6px rgba(0,0,0,0.5);
    }
    #reset-btn:hover { background:#f00; }
  </style>
</head>
<body>

<div id="container">
  <div class="tab-buttons">
    <button onclick="openTab('page1', this)" class="active">Page 1: Attributes</button>
    <button onclick="openTab('page2', this)">Page 2: Talents & Inventory</button>
    <button onclick="openTab('page3', this)">Page 3: Augments</button>
    <button onclick="openTab('page4', this)">Page 4: Biography</button>
    <button onclick="openTab('page5', this)">Page 5: Extra Bio</button>
  </div>

  <button id="export-btn" onclick="exportData()">Export Data</button>
  <input type="file" id="import-btn" accept=".json" style="display:none;" onchange="importData(event)">
  <button onclick="document.getElementById('import-btn').click()">Import Data</button>

  <!-- Reset button with confirmation -->
  <button id="reset-btn" onclick="clearAllData()">Reset / Clear All Saved Data</button>

  <div id="page1" class="tab-content active">
    <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/CHARACTER%20SHEET%201.png" alt="Page 1">
    
    <!-- Avatar overlay -->
    <img id="avatar" src="" alt="Character Avatar">
    <div id="avatar-input" class="overlay">
      <input type="text" data-key="avatar-url" placeholder="Avatar URL" style="width:100%; margin-bottom:5px;">
      <input type="file" accept="image/*" onchange="handleAvatarUpload(this)">
    </div>
    
    <!-- Name -->
    <div class="overlay" style="top:376px; left:43px; width:152px;">
      <input type="text" data-key="name" placeholder="Name" style="width:100%;">
    </div>
    
    <!-- Titles -->
    <div class="overlay" style="top:417px; left:3px; width:355px; height:48px;">
      <textarea data-key="Titles" placeholder="Titles and Aliases..." style="width:100%; height:100%;"></textarea>
    </div>
    
    <!-- LV -->
    <div class="overlay" style="top:475px; left:280px; width:77px;">
      <input type="number" data-key="lv" placeholder="LV" style="width:100%;">
    </div>
    
    <!-- Health -->
    <div class="overlay" style="top:490px; left:1px; width:374px;">
      <div style="display:flex; align-items:center; gap:3px; height:50px;">
        <span style="font-weight:bold; font-size:18px; white-space:nowrap;"></span>
        <input type="number" id="health-input" data-key="health" min="0" max="100" value="50" step="1" 
               style="width:50px; height:40px; font-size:20px; text-align:center; background:rgba(0,0,0,0.6); color:#0ff; border:2px solid #0ff; padding:0;"
               oninput="updateHealthFill(this.value); saveData(this)">
        <span style="font-weight:bold; font-size:20px;"></span>
        <div class="bar" style="flex:1;"><div class="bar-fill" id="health-fill"></div></div>
      </div>
    </div>
    
   <!-- Mana -->
<div class="overlay" style="top:543px; left:9px; width:354px;">
  <div style="display:flex; gap:6px; height:40px;">  <!-- align-items:center removed/commented as per your DevTools -->
    <span style="font-weight:bold; font-size:18px; white-space:nowrap;"></span>
    <input type="number" id="mana-input" data-key="mana" min="0" max="100" value="50" step="1" 
           style="width:44px; height:40px; font-size:18px; text-align:center; background:rgba(0,0,0,0.6); color:#0ff; border:2px solid #0ff; padding:0;"
           oninput="updateManaFill(this.value); saveData(this)">
    <span style="font-weight:bold; font-size:20px;"></span>
    <div class="bar" style="flex:1; height:20px; background:#333; border:1px solid #0ff; position:relative;">
      <div class="bar-fill" id="mana-fill" style="height:100%; background:linear-gradient(to right, #a0f, #f0f); position:absolute; left:0; top:0;"></div>
    </div>
  </div>
</div>iv>
    
    <!-- EXP -->
    <div class="overlay" style="top:196px; left:290px; width:36px;">
      <input type="number" data-key="exp" placeholder="EXP" style="width:100%;">
    </div>
    
    <!-- FAME -->
    <div class="overlay" style="top:115px; left:290px; width:36px;">
      <input type="number" data-key="fame" placeholder="FAME" style="width:100%;">
    </div>
    
    <!-- Kills -->
    <div class="overlay" style="top:358px; left:280px; width:47px;">
      <input type="number" data-key="kills" placeholder="Kills" style="width:100%;">
    </div>
    
    <!-- FatePoint -->
    <div class="overlay" style="top:290px; left:280px; width:47px;">
      <input type="number" data-key="fatepoint" placeholder="FatePoint" style="width:100%;">
    </div>
    
    <!-- Mental Attributes -->
    <div class="overlay" style="top:98px; left:370px; width:480px;">
      <div class="skill-row">
        <span class="skill-label"></span>
        <span class="dot" data-key="wits1" onclick="toggleDot(this)">○</span><span class="dot" data-key="wits2" onclick="toggleDot(this)">○</span><span class="dot" data-key="wits3" onclick="toggleDot(this)">○</span><span class="dot" data-key="wits4" onclick="toggleDot(this)">○</span><span class="dot" data-key="wits5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="wits-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:14px;">
        <span class="skill-label"></span>
        <span class="dot" data-key="perc1" onclick="toggleDot(this)">○</span><span class="dot" data-key="perc2" onclick="toggleDot(this)">○</span><span class="dot" data-key="perc3" onclick="toggleDot(this)">○</span><span class="dot" data-key="perc4" onclick="toggleDot(this)">○</span><span class="dot" data-key="perc5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="perc-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:16px;">
        <span class="skill-label"></span>
        <span class="dot" data-key="int1" onclick="toggleDot(this)">○</span><span class="dot" data-key="int2" onclick="toggleDot(this)">○</span><span class="dot" data-key="int3" onclick="toggleDot(this)">○</span><span class="dot" data-key="int4" onclick="toggleDot(this)">○</span><span class="dot" data-key="int5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="int-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:19px;">
        <span class="skill-label"></span>
        <span class="dot" data-key="char1" onclick="toggleDot(this)">○</span><span class="dot" data-key="char2" onclick="toggleDot(this)">○</span><span class="dot" data-key="char3" onclick="toggleDot(this)">○</span><span class="dot" data-key="char4" onclick="toggleDot(this)">○</span><span class="dot" data-key="char5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="char-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:16px;">
        <span class="skill-label"></span>
        <span class="dot" data-key="manip1" onclick="toggleDot(this)">○</span><span class="dot" data-key="manip2" onclick="toggleDot(this)">○</span><span class="dot" data-key="manip3" onclick="toggleDot(this)">○</span><span class="dot" data-key="manip4" onclick="toggleDot(this)">○</span><span class="dot" data-key="manip5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="manip-sum">0</span>
      </div>
    </div>
    
    <!-- Physical Attributes -->
    <div class="overlay" style="top:450px; left:360px; width:480px;">
      <div class="skill-row">
        <span class="skill-label"></span>
        <span class="dot" data-key="str1" onclick="toggleDot(this)">○</span><span class="dot" data-key="str2" onclick="toggleDot(this)">○</span><span class="dot" data-key="str3" onclick="toggleDot(this)">○</span><span class="dot" data-key="str4" onclick="toggleDot(this)">○</span><span class="dot" data-key="str5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="str-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:30px;">
        <span class="skill-label"></span>
        <span class="dot" data-key="dex1" onclick="toggleDot(this)">○</span><span class="dot" data-key="dex2" onclick="toggleDot(this)">○</span><span class="dot" data-key="dex3" onclick="toggleDot(this)">○</span><span class="dot" data-key="dex4" onclick="toggleDot(this)">○</span><span class="dot" data-key="dex5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="dex-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:30px;">
        <span class="skill-label">Stamina</span>
        <span class="dot" data-key="stam1" onclick="toggleDot(this)">○</span><span class="dot" data-key="stam2" onclick="toggleDot(this)">○</span><span class="dot" data-key="stam3" onclick="toggleDot(this)">○</span><span class="dot" data-key="stam4" onclick="toggleDot(this)">○</span><span class="dot" data-key="stam5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="stam-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:30px;">
        <span class="skill-label"></span>
        <span class="dot" data-key="psio1" onclick="toggleDot(this)">○</span><span class="dot" data-key="psio2" onclick="toggleDot(this)">○</span><span class="dot" data-key="psio3" onclick="toggleDot(this)">○</span><span class="dot" data-key="psio4" onclick="toggleDot(this)">○</span><span class="dot" data-key="psio5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="psio-sum">0</span>
      </div>
    </div>
    
    <!-- Talents and Debuffs -->
    <div class="overlay" style="top:80px; left:838px; width:342px; height:566px;">
      <textarea data-key="talents" placeholder="Talents and Debuffs..." style="width:100%; height:100%;"></textarea>
    </div>
  </div>

  <!-- Page 2 -->
  <div id="page2" class="tab-content">
    <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/CHARACTER%20SHEET%20inventory2.png" alt="Page 2">
    
    <!-- Left column skills -->
    <div class="overlay skills-column" style="top:60px; left:50px; width:480px;">
      <div class="skill-row">
        <span class="skill-label">Alertness</span>
        <span class="dot" data-key="alert1" onclick="toggleDot(this)">○</span><span class="dot" data-key="alert2" onclick="toggleDot(this)">○</span><span class="dot" data-key="alert3" onclick="toggleDot(this)">○</span><span class="dot" data-key="alert4" onclick="toggleDot(this)">○</span><span class="dot" data-key="alert5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="alert-sum">0</span>
      </div>
      
      <div class="skill-row" style="margin-top:30px;">
        <span class="skill-label">Art</span>
        <span class="dot" data-key="art1" onclick="toggleDot(this)">○</span><span class="dot" data-key="art2" onclick="toggleDot(this)">○</span><span class="dot" data-key="art3" onclick="toggleDot(this)">○</span><span class="dot" data-key="art4" onclick="toggleDot(this)">○</span><span class="dot" data-key="art5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="art-sum">0</span>
      </div>
      
      <!-- Add more left column skills here as needed -->
    </div>
    
    <!-- Right column skills -->
    <div class="overlay skills-column" style="top:60px; left:660px; width:480px;">
      <div class="skill-row">
        <span class="skill-label">Animal Ken</span>
        <span class="dot" data-key="animalken1" onclick="toggleDot(this)">○</span><span class="dot" data-key="animalken2" onclick="toggleDot(this)">○</span><span class="dot" data-key="animalken3" onclick="toggleDot(this)">○</span><span class="dot" data-key="animalken4" onclick="toggleDot(this)">○</span><span class="dot" data-key="animalken5" onclick="toggleDot(this)">○</span>
        <span class="pool-sum" id="animalken-sum">0</span>
      </div>
      
      <!-- Add more right column skills here -->
    </div>
    
    <!-- Player Inventory -->
    <div class="overlay" style="top:600px; left:50px; width:1100px; height:240px;">
      <textarea data-key="inventory" placeholder="Player Inventory..." style="width:100%; height:100%;"></textarea>
    </div>
  </div>

  <!-- Page 3 -->
  <div id="page3" class="tab-content">
    <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/back%20fill%20CHARACTER%203.png" alt="Page 3">
    
    <!-- Augments (rough positions – adjust later) -->
    <div class="overlay" style="top:100px; left:240px; width:240px;">
      <textarea data-key="head-augment" placeholder="Head Augment/Injury" style="width:100%; height:60px;"></textarea>
    </div>
    
    <div class="overlay" style="top:180px; left:60px; width:240px;">
      <textarea data-key="left-upper" placeholder="Left Upper" style="width:100%; height:60px;"></textarea>
    </div>
    
    <div class="overlay" style="top:240px; left:720px; width:240px;">
      <textarea data-key="right-arm" placeholder="Right Arm" style="width:100%; height:60px;"></textarea>
    </div>
    
    <div class="overlay" style="top:480px; left:360px; width:240px;">
      <textarea data-key="torso" placeholder="Torso" style="width:100%; height:60px;"></textarea>
    </div>
    
    <div class="overlay" style="top:600px; left:120px; width:240px;">
      <textarea data-key="left-leg" placeholder="Left Leg" style="width:100%; height:60px;"></textarea>
    </div>
    
    <div class="overlay" style="top:600px; left:600px; width:240px;">
      <textarea data-key="right-leg" placeholder="Right Leg" style="width:100%; height:60px;"></textarea>
    </div>
  </div>

  <!-- Page 4 -->
  <div id="page4" class="tab-content">
    <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/back%20fill%20bio%204.png" alt="Page 4">
    
    <div class="overlay" style="top:120px; left:60px; width:240px;">
      <input type="text" data-key="planet" placeholder="Planet of Origin" style="width:100%;">
    </div>
    
    <div class="overlay" style="top:180px; left:60px; width:140px;">
      <input type="number" data-key="age" placeholder="Apparent Age" style="width:100%;">
    </div>
    
    <div class="overlay" style="top:180px; left:240px; width:140px;">
      <input type="text" data-key="race" placeholder="Race" style="width:100%;">
    </div>
    
    <div class="overlay" style="top:240px; left:60px; width:360px; height:500px;">
      <textarea data-key="biography" placeholder="Biography..." style="width:100%; height:100%;"></textarea>
    </div>
    
    <div class="overlay" style="top:120px; left:520px; width:600px; height:620px;">
      <textarea data-key="motives" placeholder="Motives..." style="width:100%; height:100%;"></textarea>
    </div>
  </div>

  <!-- Page 5 -->
  <div id="page5" class="tab-content">
    <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/back%20fill%20bio%204%20-%20Copy.png" alt="Page 5">
    
    <div class="overlay" style="top:120px; left:60px; width:240px;">
      <input type="text" data-key="planet-extra" placeholder="Planet of Origin (Extra)" style="width:100%;">
    </div>
    
    <!-- Add more fields as needed -->
  </div>

</div>

<script>
// ────────────────────────────────────────────────
// PLAYER NAMESPACING & SAVE / LOAD / CLEAR SYSTEM
// ────────────────────────────────────────────────

// 1. Player-specific storage prefix
let playerKey = localStorage.getItem('playerName') || prompt('Enter your player name:') || 'default';
localStorage.setItem('playerName', playerKey);

function getStorageKey(key) {
  return `${playerKey}_${key}`;
}

// 2. Save single element
function saveData(el) {
  const key = getStorageKey(el.dataset.key);
  if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
    localStorage.setItem(key, el.value);
  } else {
    localStorage.setItem(key, el.textContent);
  }
}

// 3. Auto-save every 5 seconds
setInterval(() => {
  document.querySelectorAll('input, textarea, .dot').forEach(saveData);
}, 5000);

// 4. Load all saved data when page opens
window.addEventListener('load', () => {
  // Restore inputs & textareas
  document.querySelectorAll('input[data-key], textarea[data-key]').forEach(el => {
    el.value = localStorage.getItem(getStorageKey(el.dataset.key)) || '';
    if (el.type === 'range') updateBar(el, `${el.dataset.key}-fill`);
    el.addEventListener('input', () => saveData(el));
  });
  const healthInput = document.querySelector('[data-key="health"]');
  if (healthInput) {
    updateHealthFill(healthInput.value);
  }
  const manaInput = document.querySelector('[data-key="mana"]');
  if (manaInput) {
    updateManaFill(manaInput.value);
  }

  // Restore dots
  document.querySelectorAll('.dot').forEach(el => {
    const saved = localStorage.getItem(getStorageKey(el.dataset.key));
    if (saved) {
      el.textContent = saved;
      if (saved === '●') el.classList.add('filled');
    }
    updateSum(el.closest('.skill-row'));
  });

  // Restore avatar
  const avatarUrl = localStorage.getItem(getStorageKey('avatar-url'));
  const avatarData = localStorage.getItem(getStorageKey('avatar-data'));
  document.getElementById('avatar').src = avatarData || avatarUrl || '';
  document.querySelector('[data-key="avatar-url"]').addEventListener('input', e => {
    document.getElementById('avatar').src = e.target.value;
    saveData(e.target);
  });
});

// 5. Clear / Reset all saved data with confirmation popup
function clearAllData() {
  const confirmed = confirm(
    "Are you sure you want to CLEAR ALL saved data for this character?\n\n" +
    "This will permanently delete:\n" +
    "• All stats, dots, numbers, text\n" +
    "• Talents, inventory, biography, augments\n" +
    "• Avatar image and URL\n" +
    "• Everything saved for this player name\n\n" +
    "This CANNOT be undone!\n\n" +
    "Click OK to reset everything, or Cancel to keep your data."
  );

  if (confirmed) {
    // Remove only this player's data
    Object.keys(localStorage).forEach(key => {
      if (key.startsWith(playerKey + '_')) {
        localStorage.removeItem(key);
      }
    });
    // Reload to show blank sheet
    location.reload();
  }
}

// ────────────────────────────────────────────────
// YOUR EXISTING FUNCTIONS (unchanged)
// ────────────────────────────────────────────────

function openTab(tabId, button) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.tab-buttons button').forEach(el => el.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  button.classList.add('active');
}

function toggleDot(el) {
  el.textContent = el.textContent === '○' ? '●' : '○';
  el.classList.toggle('filled');
  saveData(el);
  updateSum(el.closest('.skill-row'));
}

function updateSum(section) {
  const sumEl = section.querySelector('.pool-sum');
  if (sumEl) sumEl.textContent = section.querySelectorAll('.filled').length;
}

function updateHealthFill(value) {
  const fill = document.getElementById('health-fill');
  if (fill) {
    fill.style.width = `${value}%`;
  }
}

function updateManaFill(value) {
  const fill = document.getElementById('mana-fill');
  if (fill) {
    fill.style.width = `${value}%`;
  }
}

function handleAvatarUpload(input) {
  const file = input.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = e => {
      document.getElementById('avatar').src = e.target.result;
      localStorage.setItem(getStorageKey('avatar-data'), e.target.result);
    };
    reader.readAsDataURL(file);
  }
}

function exportData() {
  const data = {};
  document.querySelectorAll('[data-key]').forEach(el => {
    data[el.dataset.key] = el.value || el.textContent;
  });
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'character-sheet.json';
  a.click();
  URL.revokeObjectURL(url);
}

function importData(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = e => {
      const data = JSON.parse(e.target.result);
      Object.keys(data).forEach(key => {
        const el = document.querySelector(`[data-key="${key}"]`);
        if (el) {
          if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
            el.value = data[key];
          } else {
            el.textContent = data[key];
            if (data[key] === '●') el.classList.add('filled');
          }
        }
        if (key === 'avatar-data' || key === 'avatar-url') {
          document.getElementById('avatar').src = data[key];
        }
      });
      document.querySelectorAll('.skill-row').forEach(updateSum);
    };
    reader.readAsText(file);
  }
}
</script>

</body>
</html>


