<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dead End Traders - Character Sheet</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #000;
      color: #0ff;
    }
    #container {
      width: 100%;
      max-width: 1200px;
      margin: 20px auto;
    }
    .tab-buttons {
      text-align: center;
      margin-bottom: 20px;
    }
    .tab-buttons button {
      background: #0ff;
      color: #000;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
    }
    .tab-buttons button.active {
      background: #ff0;
    }
    .tab-content {
      display: none;
      position: relative;
    }
    .tab-content.active {
      display: block;
    }
    .sheet-container {
      position: relative;
      width: 100%;
    }
    .sheet-container img.sheet {
      width: 100%;
      display: block;
    }
    .overlay {
      position: absolute;
      color: #0ff;
      font-size: 16px;
    }
    input, textarea {
      background: rgba(0,0,0,0.6);
      color: #0ff;
      border: 1px solid #0ff;
      padding: 4px;
    }
    .dot {
      cursor: pointer;
      width: 20px;
      height: 20px;
      line-height: 20px;
      text-align: center;
      font-size: 18px;
      display: inline-block;
      margin: 0 2px;
    }
    .filled {
      color: #ff0;
    }
    .pool-sum {
      font-weight: bold;
      margin-left: 10px;
    }
    .bar {
      width: 100%;
      height: 10px;
      background: #333;
      border: 1px solid #0ff;
    }
    .bar-fill {
      height: 100%;
      background: linear-gradient(to right, #0ff, #00f);
    }
    #avatar {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border: none;
    }
    #export-btn {
      background: #ff0;
      color: #000;
      border: none;
      padding: 10px;
      cursor: pointer;
      margin-top: 10px;
    }
    #reset-btn {
      background: #c00;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      margin: 20px 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }
    #reset-btn:hover { background:#f00; }
  </style>
</head>
<body>

<div id="container">

  <!-- Tabs -->
  <div class="tab-buttons">
    <button onclick="openTab('page1', event)" class="active">Page 1: Attributes</button>
    <button onclick="openTab('page2', event)">Page 2: Talents & Inventory</button>
    <button onclick="openTab('page3', event)">Page 3: Augments</button>
    <button onclick="openTab('page4', event)">Page 4: Biography</button>
    <button onclick="openTab('page5', event)">Page 5: Extra Bio</button>
  </div>

  <!-- Export/Import -->
  <button id="export-btn" onclick="exportData()">Export Data</button>
  <input type="file" id="import-btn" accept=".json" style="display:none;" onchange="importData(event)">
  <button onclick="document.getElementById('import-btn').click()">Import Data</button>

  <!-- Reset -->
  <button id="reset-btn" onclick="clearAllData()">Reset / Clear All Saved Data</button>

  <!-- ───────────── PAGE 1 ───────────── -->
  <div id="page1" class="tab-content active">
    <div class="sheet-container">
      <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/CHARACTER%20SHEET%201.png" alt="Page 1">

      <!-- Avatar -->
      <div class="overlay" style="top:5%; left:5%; width:20%; height:40%;">
        <img id="avatar" src="">
      </div>
      <div class="overlay" style="top:46%; left:5%; width:20%;">
        <input type="text" data-key="avatar-url" placeholder="Avatar URL">
        <input type="file" accept="image/*" onchange="handleAvatarUpload(this)">
      </div>

      <!-- Name, Titles, LV -->
      <div class="overlay" style="top:50%; left:30%; width:20%;">
        <input type="text" data-key="name" placeholder="Name" style="width:100%;">
      </div>
      <div class="overlay" style="top:55%; left:30%; width:20%;">
        <input type="text" data-key="titles" placeholder="Titles" style="width:100%;">
      </div>
      <div class="overlay" style="top:60%; left:30%; width:10%;">
        <input type="number" data-key="lv" placeholder="LV" style="width:100%;">
      </div>

      <!-- Health Bar -->
      <div class="overlay" style="top:65%; left:30%; width:20%;">
        <div class="bar"><div class="bar-fill" id="health-fill" style="width:50%;"></div></div>
        <input type="range" data-key="health" min="0" max="100" value="50" style="width:100%;" oninput="updateBar(this, 'health-fill')">
      </div>

      <!-- Mental Attributes Dots -->
      <div class="overlay" style="top:20%; left:30%; width:50%;">
        <!-- Example: Wits -->
        <div class="skill-row">
          <span>Wits</span>
          <span class="dot" data-key="wits1" onclick="toggleDot(this)">○</span>
          <span class="dot" data-key="wits2" onclick="toggleDot(this)">○</span>
          <span class="dot" data-key="wits3" onclick="toggleDot(this)">○</span>
          <span class="dot" data-key="wits4" onclick="toggleDot(this)">○</span>
          <span class="dot" data-key="wits5" onclick="toggleDot(this)">○</span>
          <span class="pool-sum" id="wits-sum">0</span>
        </div>
        <!-- Add Perception, Intelligence, etc. similarly -->
      </div>
    </div>
  </div>

  <!-- ───────────── PAGE 2 ───────────── -->
  <div id="page2" class="tab-content">
    <div class="sheet-container">
      <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/CHARACTER%20SHEET%20inventory2.png" alt="Page 2">
      <!-- Skills columns, inventory -->
      <div class="overlay" style="top:10%; left:5%; width:45%;">
        <div class="skill-row">
          <span>Alertness</span>
          <span class="dot" data-key="alert1" onclick="toggleDot(this)">○</span>
          <span class="dot" data-key="alert2" onclick="toggleDot(this)">○</span>
          <span class="dot" data-key="alert3" onclick="toggleDot(this)">○</span>
        </div>
      </div>
      <div class="overlay" style="top:10%; left:55%; width:40%;">
        <div class="skill-row">
          <span>Animal Ken</span>
          <span class="dot" data-key="animalken1" onclick="toggleDot(this)">○</span>
          <span class="dot" data-key="animalken2" onclick="toggleDot(this)">○</span>
        </div>
      </div>
      <div class="overlay" style="top:70%; left:5%; width:90%; height:20%;">
        <textarea data-key="inventory" placeholder="Player Inventory..." style="width:100%; height:100%;"></textarea>
      </div>
    </div>
  </div>

  <!-- ───────────── PAGE 3 ───────────── -->
  <div id="page3" class="tab-content">
    <div class="sheet-container">
      <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/back%20fill%20CHARACTER%203.png" alt="Page 3">
      <div class="overlay" style="top:10%; left:20%; width:20%; height:5%;">
        <textarea data-key="head-augment" placeholder="Head Augment/Injury" style="width:100%; height:100%;"></textarea>
      </div>
      <!-- Add left-upper, right-arm, torso, legs similarly -->
    </div>
  </div>

  <!-- ───────────── PAGE 4 ───────────── -->
  <div id="page4" class="tab-content">
    <div class="sheet-container">
      <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/back%20fill%20bio%204.png" alt="Page 4">
      <div class="overlay" style="top:10%; left:5%; width:20%;">
        <input type="text" data-key="planet" placeholder="Planet of Origin" style="width:100%;">
      </div>
      <div class="overlay" style="top:20%; left:5%; width:20%;">
        <input type="number" data-key="age" placeholder="Apparent Age" style="width:100%;">
      </div>
      <div class="overlay" style="top:25%; left:5%; width:30%; height:50%;">
        <textarea data-key="biography" placeholder="Biography..." style="width:100%; height:100%;"></textarea>
      </div>
      <div class="overlay" style="top:25%; left:40%; width:50%; height:50%;">
        <textarea data-key="motives" placeholder="Motives..." style="width:100%; height:100%;"></textarea>
      </div>
    </div>
  </div>

  <!-- ───────────── PAGE 5 ───────────── -->
  <div id="page5" class="tab-content">
    <div class="sheet-container">
      <img class="sheet" src="https://raw.githubusercontent.com/Vanoth/Dead-End-Traders-character-sheets/main/back%20fill%20bio%204%20-%20Copy.png" alt="Page 5">
      <div class="overlay" style="top:10%; left:5%; width:20%;">
        <input type="text" data-key="planet-extra" placeholder="Planet of Origin (Extra)" style="width:100%;">
      </div>
    </div>
  </div>

</div>

<script>
  // ───────────── TAB FUNCTION ─────────────
  function openTab(tabId, event) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.tab-buttons button').forEach(el => el.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    if (event) event.currentTarget.classList.add('active');
  }

  // ───────────── DOTS ─────────────
  function toggleDot(dot) {
    dot.textContent = dot.textContent === '○' ? '●' : '○';
    dot.classList.toggle('filled');
    saveData(dot);
    const row = dot.closest('.skill-row');
    if(row) row.querySelector('.pool-sum')?.textContent = row.querySelectorAll('.dot.filled').length;
  }

  // ───────────── BARS ─────────────
  function updateBar(input, fillId){
    document.getElementById(fillId).style.width = input.value+'%';
    saveData(input);
  }

  // ───────────── AVATAR ─────────────
  function handleAvatarUpload(input){
    const file = input.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = e => {
        document.getElementById('avatar').src = e.target.result;
        localStorage.setItem(getStorageKey('avatar-data'), e.target.result);
      };
      reader.readAsDataURL(file);
    }
  }

  // ───────────── STORAGE ─────────────
  let playerKey = localStorage.getItem('playerName') || prompt('Enter your player name:') || 'default';
  localStorage.setItem('playerName', playerKey);
  function getStorageKey(key){return `${playerKey}_${key}`;}
  function saveData(el){
    const key = getStorageKey(el.dataset.key);
    if(el.tagName==='INPUT'||el.tagName==='TEXTAREA') localStorage.setItem(key, el.value);
    else localStorage.setItem(key, el.textContent);
  }

  // Load saved data
  window.addEventListener('load', () => {
    document.querySelectorAll('input[data-key], textarea[data-key]').forEach(el=>{
      el.value = localStorage.getItem(getStorageKey(el.dataset.key))||'';
      if(el.type==='range') updateBar(el, `${el.dataset.key}-fill`);
      el.addEventListener('input',()=>saveData(el));
    });
    document.querySelectorAll('.dot').forEach(dot=>{
      const saved = localStorage.getItem(getStorageKey(dot.dataset.key));
      if(saved){
        dot.textContent = saved;
        dot.classList.toggle('filled', saved==='●');
      }
      const row = dot.closest('.skill-row');
      if(row) row.querySelector('.pool-sum')?.textContent = row.querySelectorAll('.dot.filled').length;
    });
    const avatar = document.getElementById('avatar');
    avatar.src = localStorage.getItem(getStorageKey('avatar-data')) || localStorage.getItem(getStorageKey('avatar-url')) || '';
    document.querySelector('[data-key="avatar-url"]').addEventListener('input', e=>{
      avatar.src = e.target.value;
      saveData(e.target);
    });
  });

  // Autosave every 5 sec
  setInterval(()=>{
    document.querySelectorAll('input,textarea').forEach(saveData);
    document.querySelectorAll('.dot.filled').forEach(saveData);
  },5000);

  // ───────────── RESET ─────────────
  function clearAllData(){
    if(!confirm("Are you sure you want to CLEAR ALL saved data for this character?")) return;
    Object.keys(localStorage).forEach(key=>{
      if(key.startsWith(playerKey+'_')) localStorage.removeItem(key);
    });
    location.reload();
  }

  // ───────────── EXPORT/IMPORT ─────────────
  function exportData(){
    const data={};
    document.querySelectorAll('[data-key]').forEach(el=>{
      data[el.dataset.key]=el.tagName==='INPUT'||el.tagName==='TEXTAREA'?el.value:el.textContent;
    });
    const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url;
    a.download='character-sheet.json';
    a.click();
    URL.revokeObjectURL(url);
  }
  function importData(event){
    const file=event.target.files[0];
    if(!file) return;
    const reader=new FileReader();
    reader.onload=e=>{
      const data=JSON.parse(e.target.result);
      Object.entries(data).forEach(([key,value])=>{
        const el=document.querySelector(`[data-key="${key}"]`);
        if(!el) return;
        if(el.tagName==='INPUT'||el.tagName==='TEXTAREA') el.value=value;
        else { el.textContent=value; el.classList.toggle('filled', value==='●'); }
        if(key==='avatar-data'||key==='avatar-url') document.getElementById('avatar').src=value;
      });
      document.querySelectorAll('.skill-row').forEach(row=>{
        row.querySelector('.pool-sum')?.textContent=row.querySelectorAll('.dot.filled').length;
      });
    };
    reader.readAsText(file);
  }
</script>

</body>
</html>
